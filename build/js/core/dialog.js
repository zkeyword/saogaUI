define(["core/saogaUI","core/drag","i18n!core/nls/str"],function(e,t,n){var r={init:function(n){var r=n||{},i=r.title||"",s=r.text||"",o=r.btns||"",u=r.type||"",a=r.top,f=r.left,l=r.ok||"",c=r.no||"",h=r.width||200,p=r.height||50,d=r.id||"l-dialog-"+(new Date).valueOf(),v="l-dialog-title"+(new Date).valueOf(),m=r.isMask===undefined||r.isMask,g=r.isMaskClose===undefined||r.isMaskClose,y=r.allowClose===undefined||r.allowClose,b=r.allowEscClose===undefined||r.allowEscClose,w=r.isDrag===undefined||r.isDrag,E="";E+='<div class="l-ui l-dialog-wrap" id="'+d+'">',E+='	<table class="l-dialog-table">',E+='		<tr><td colspan="3" class="l-dialog-border l-dialog-border-top">&nbsp;</td></tr>',E+="		<tr>",E+='			<td class="l-dialog-border l-dialog-border-left">&nbsp;</td>',E+='			<td class="l-dialog-main"><div class="l-dialog-content" style="width:'+h+"px;height:"+p+'px">'+s+"</div></td>",E+='			<td class="l-dialog-border l-dialog-border-right">&nbsp;</td>',E+="		</tr>",E+='		<tr><td colspan="3" class="l-dialog-border l-dialog-border-bottom">&nbsp;</td></tr>',E+="	</table>",E+="</div>",e.ui.wrap(),$("#l-ui-wrap").prepend(E);var S=e.ui.zIndex(),x=$("#"+d).css({"z-index":S}),T=x.find(".l-dialog-main"),N=x.find(".l-dialog-content");i&&T.prepend('<div class="l-dialog-title" id="'+v+'">'+i+"</div>"),u&&T.find(".l-dialog-content").addClass("l-dialog-"+u);var C=0,k=T.append('<div class="ui-floatCenter l-dialog-btnWrap"><div class="ui-sl-floatCenter"></div></div>').find(".ui-floatCenter"),L=T.find(".ui-sl-floatCenter"),A=k.height();if(o)$.each(o,function(t,n){L.append('<a href="javascript:;" class="'+(n.cls?"ui-btn ui-btnMain ui-floatCenter-item "+n.cls:"ui-btn ui-btnMain ui-floatCenter-item")+'"><span>'+n.text+"</span></a>"),n.onclick&&L.find("a").eq(t).click(function(){n.onclick(t,n),e.ui.dialog.close(d)})});else switch(u){case"alert":L.append('<a href="javascript:;" class="ui-btn ui-btnMain ui-floatCenter-item l-dialog-ok"><span>确定</span></a>'),L.find(".l-dialog-ok").click(function(){e.base.isFunction(l)&&l(),e.ui.dialog.close(d)});break;case"confirm":L.append('<a href="javascript:;" class="ui-btn ui-btnMain ui-floatCenter-item l-dialog-ok"><span>确定</span></a><a href="javascript:;" class="ui-btn ui-btnMain ui-btnMain-cancel ui-floatCenter-item l-dialog-no"><span>取消</span></a>'),L.find(".l-dialog-ok").click(function(){e.base.isFunction(l)&&l(),e.ui.dialog.close(d)}),L.find(".l-dialog-no").click(function(){e.base.isFunction(c)&&c(),e.ui.dialog.close(d)});break;case"error":L.append('<a href="javascript:;" class="ui-btn ui-btnMain ui-btnMain-cancel ui-floatCenter-item l-dialog-no"><span>取消</span></a>'),L.find(".l-dialog-no").click(function(){e.base.isFunction(c)&&c(),e.ui.dialog.close(d)})}var O=$(window),a=a||O.scrollTop()+O.height()/2-x.height()/2,f=f||(O.width()-x.width())/2;x.css({top:a,left:f}),m&&e.ui.lock(),w&&t({dragItem:"#"+v,dragWrap:"#"+d});if(y){var M=T.prepend('<div class="l-dialog-close">x</div>').find(".l-dialog-close");M.click(function(){e.ui.dialog.close(d)});if(b){var _=function(t){t=t||event;var n=t.which||event.keyCode;n===27&&e.ui.dialog.close(d)};document.attachEvent?document.attachEvent("onkeydown",_):document.addEventListener("keydown",_,!0)}}},close:function(t){t?$("#"+t).remove():$(".l-dialog-wrap").remove(),$(".l-ui-mask").length||e.ui.unlock()},alert:function(e){var t=e||{},r=t.title||n.alert,i=t.text||"",s=t.ok||"";this.init({title:r,text:i,type:"alert",ok:s})},confirm:function(e){var t=e||{},r=t.title||n.confirm,i=t.text||"",s=t.ok||"",o=t.no||"";this.init({title:r,text:i,type:"confirm",ok:s,no:o})},error:function(e){var t=e||{},r=t.title||"",i=t.text||n.error,s=t.no||"";this.init({title:r,text:i,type:"error",no:s})},prompt:function(t){function g(){e.ui.dialog.close(r),l&&typeof l=="function"&&l()}var n=t||{},r=n.id||"l-dialog-"+(new Date).valueOf(),i=n.top,s=n.left,o=n.cls||"",u=n.text||"",a=n.isMask||!0,f=n.showTime||2e3,l=n.endFn||"",c=n.width||"",h=n.height||"auto";e.ui.wrap();var p="";p+='<div class="l-ui l-dialog-wrap" id="'+r+'">',p+='	<div class="l-dialog-prompt">'+u+"</div>",p+="</div>",$("#l-ui-wrap").prepend(p);var d=e.ui.zIndex(),v=$("#"+r).css({width:c,height:h,"z-index":d}),m=$(window),i=i||m.scrollTop()+m.height()/2-v.height()/2,s=s||(m.width()-v.width())/2;v.css({top:i,left:s}),a&&e.ui.lock(),setTimeout(g,f)}};return r});